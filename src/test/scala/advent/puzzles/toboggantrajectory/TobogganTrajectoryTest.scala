package advent.puzzles.toboggantrajectory

import advent.utils.InputParser
import org.scalatest.wordspec.AnyWordSpec
import org.scalatest.matchers.should.Matchers

class TobogganTrajectoryTest extends AnyWordSpec with Matchers {

  "TobogganTrajectoryTest" when {
    def exampleInput = InputParser.parse[String](
      "..##.......\n#...#...#..\n.#....#..#.\n..#.#...#.#\n.#...##..#.\n..#.##.....\n.#.#.#....#\n.#........#\n#.##...#...\n#...##....#\n.#..#...#.#")
    def longInput = InputParser.parse[String](
      ".#..#.....#....##..............\n...#.#...#...#.#..........#....\n#...###...#.#.....#.##.#.#...#.\n#.....#.#...##....#...#...#....\n##.......##.#.....#........##.#\n#..#....#......#..#......#...#.\n#..#......#.......#............\n##...#.#..#...#........#....##.\n#.#.#...#...#..#........#....#.\n.......#...........##......#...\n##.##.##......#..#............#\n..#.###..#..............#......\n.##..#.....#......#.#..........\n........#.........#....#....###\n#..........#........#.#.#......\n...##.....#..####.###..#.##....\n....#...###............#..#....\n...#.#...#.#...#..#.#........##\n.....#...#.............#..#....\n....#.#.#.##.....##.##....#....\n..#....#............#.##.##..#.\n.#..#..#................#...###\n#..###.#..##..#............#...\n.......#.#....#.##.#.##........\n##...###.#....#...........###.#\n...#.#....#..####.........#....\n....##........#.#.#.###........\n#...#..#.....#....##..#.##...#.\n##....................##..#....\n.#....##...........##...##...#.\n.#.#..#.........#.........#.#.#\n#.#..#.....#.#..#..#..#.#......\n...#.............#......#....##\n....#.#.......#....#...#.##...#\n#.#.#..###..........#...#......\n......#.....#..#..#.......##..#\n.#......#......#.....#...#.....\n......#..#......#.#............\n..#............#..#....#.#.....\n.....#..##.......#...##.###.#.#\n.....#........##....#.#...##..#\n..........##.#..#.#...#..#....#\n#.#.#.#.##...................#.\n.....#....##.....#..#...#..#...\n...#....#.............#....#.#.\n.........#.##..##..............\n#...#.#....#..#...#.......#....\n.#...#......#.##.#...#.#..###..\n..#.#.#......#..#...##..##.##..\n.........#.....#......##....##.\n...###.......#..#........#.....\n...#....#...#.#.#......##....#.\n.#.....#......#...##.##..#.....\n..#.##...#....####...##........\n..#.#.###....#..##.......##....\n.....#....##...#......#.......#\n.#....#......#..............#..\n.......#.#......#..#....#.#.#..\n.......#.#.........###....#....\n.#...#.......#.#..#..####....#.\n..#...#.#......#..#.##.###..#..\n..##.........#............#.#.#\n#.........##.##.........#.###..\n...#....#.......#..#..##.......\n.#....##........##.......#..#..\n...#.....#.#.##.#.#.....##.....\n.#.#........#.......#.#..#..#..\n.....####..##.##.#.#....#......\n..#.##.#.#.#....###..#....#.#..\n..##..#.#......##.#..#.........\n....#..#.#.##.......#...##.....\n....###.....#..###...#....###.#\n..#....#.......#......#...##..#\n..#..##......#....#.###..#..##.\n..#..#...............#.#.#.....\n...##...#.#..#.#...#......#....\n#....#...#.#.#.#.#....#....#...\n....##...#....#.....##..#.....#\n......##.....#...##..#.......#.\n......###......#....#.##..#....\n.....#........#........#...#..#\n.#..##.....##....#.#......#.#..\n#..#.#.....#........#......#.#.\n.#..#.##.....#####.#....#.#....\n....##........#..........#.#...\n.......#.....#.......#...#.#...\n.#....#...##.###....#.#......#.\n#...#...........##.#...........\n#...##.......#..#........#.#..#\n.....#..##..###....#.#.#....#..\n..#..#.....#............#.#....\n............#......#.....#.....\n.#..#.....##.........#....###.#\n#.........#....#....#.#..#...#.\n##.#...##....#..#...#.#...#....\n....###..##...................#\n....##...#......#...#.#...#...#\n#....#....###..........#...#..#\n.....##.#....###.###....#..###.\n#.....#...........#...........#\n##..###.##........#..#.#..#.#..\n.##...#..#.......#.#....#.....#\n......##..#..#.......#.#...##..\n......#..#..#.#...###..#.#....#\n#.##.#..#......#...##........##\n.....#..........##.....#...#...\n........#....##......#......#.#\n..#..#.#...#.#.#.......#......#\n.#....#........#............#..\n......##.....#...#.............\n#......##..#.......##....##.#..\n.....#..#..#...#.......#..#....\n...#..##.#..#.#....##.....#..##\n......#...#.#...#.#......###.#.\n.#.#...#.....#..###.....#......\n#..####.#....#.......##...#....\n.##.......#.....#.........#....\n#......##.#...............#....\n.######.#...##...#...#...#..##.\n....#...####....##.#..#...##...\n.#...................#.#..#..#.\n.#.#....##...#...#.#..#.#.#.#..\n......#......#........##.#...#.\n##..#...#..#.............##.#..\n#.............#..........#.#...\n...##.....#.............#......\n......###.....#................\n#.#.#....#..##.#.....#.........\n.#.#........#.........#.#.##.#.\n......#...##...#.#.....#....#..\n#...#.........##.##.#..........\n#..............#..#.......##...\n#...#......#.#......#...#....#.\n...#...#........#.#......#.###.\n##.....#...#.#..#..#..#.......#\n..#.##..##.........#...##.##...\n#....#....#.....#..........#...\n#.####..#..###.....#..#..#.....\n..#.....#.##.##..####....#.#.#.\n...#.#....#...#.......#..#.....\n......###...#.#..#..#..........\n.........#..#.....#.#.##......#\n.......#.#....##.....##.#..#.#.\n.#..#.#..#......##.###...##..#.\n....###...........#.....#....#.\n.#.##.....#..#.....#......##...\n#..##....#..........#.##.##..#.\n.###.#.#..#.#.....#..##....#.#.\n..##.#....#.....##..#..........\n##........#...#..#........###.#\n#...#...........##.......#.#...\n...###.....##.#....#...#...#...\n......#....#.#.......###....#..\n...#...#.......##.......###.#..\n..............#.#..........##..\n#.#....###..#..#.........#.....\n.###.#.......#.....#....#.#....\n.....###...#.#..#.#.......#....\n.........#.##.#......#.#..#....\n.......#....#....#.#....#..##.#\n...............#...##.#..#.#..#\n.....##........#..##...........\n.##.#..#....#..#.#...#.........\n.#.#..##.#..#......#....#.#...#\n##....#.......##...........#...\n..#...#.............#.#....#..#\n..#......#..#.....#...##.....#.\n....##...#.#...##...#..##......\n.....#..#..........#...........\n..##....#..#.#....#..#........#\n.###....#.....#.#....#..##.....\n#.......##.......#..#..#....#.#\n.##..#...........#..##..##..#..\n.#.................#...#....#..\n.######.......#............##..\n.#.........#......##.#.#.#.#.#.\n.#.......#...#...#....###....#.\n....#...##.#.#...#.....#.#..#..\n.#..#..#...#.....###....#......\n...#.##.###........#.....##....\n..#....#.#.#..........#..#..#..\n......#.....#...#..#..##..#.#..\n#.#.......##.......#....#.....#\n..#...#..#.#....#.##.##........\n..#....#..##..#..##......#.....\n#....#..##.....#....###........\n##...#......#..###.#.....#.....\n#..###....#...#...#...#......##\n.....###....#......#..#..#...#.\n.##......#.......##...#........\n....#.#.....##.....#.....#.....\n...##.#.....#..##...#...##.#...\n..#...#.#....#....#...##.......\n......#....#..#....#.#.........\n..........#.#.#...##....#......\n...#....................#..#...\n...#....###....#..#.....#.....#\n..#....#....#..#.#..##.#...#...\n..#.##....##.....#.#........#..\n#.....###..#.#.#...#..#....#...\n........#..#.#..#........##....\n.##....#................##.#.##\n..##...#.#.#.....##..#....#....\n....#..#....#..#........#..##..\n...#...##....#....#..##......#.\n##........#...#.....#.....#...#\n.#......#....##...#.........##.\n##........#...#.....#..#...#.#.\n...##..#..#.....#..###.#..#....\n....#..#..............#.......#\n.......#.##...#......#.###.....\n#........##..##....#.#.#.......\n#.#..##.#.......#..##.....###..\n.....##...#..#.....#...........\n...#..#..#......#...#.#........\n.#....#....#.#.....#.....#....#\n...#..#...#..#.##.#......#.#.#.\n..##....#..#..#.....#....#....#\n...#....#.##.#..#.###......#...\n.......#..#.....#.......#..#...\n..###.#####..#..##.#.........#.\n...#.......##...#.#..#.#......#\n....#...#.###..#..........#....\n...........#...#..##........#..\n.......#...#....#....#.#..#....\n.........#..........#...#....##\n.##.........##..#.......##.#...\n........#......###...##...#.#.#\n#.#...##.##...........#...#.#..\n.....###...#..##......#..#.....\n#.#.....#.#....##..........#..#\n#..#.......#.#.........####....\n#.#...#.....#........#.....#..#\n.....#..#.#.###.....#.#.###....\n.###..#......##..#..#..........\n#....#.#......#...#.##......#..\n..#.........##.#.....#.........\n...#....#.....##.#..#..##.#..#.\n##.....#.#..#.#....#......#....\n....###.#.....#.......#..#.#...\n#.....##.....##...........#....\n..........#..#......#.##...#...\n#...#.###....##....#.###..###..\n##........#.#...#..#.........#.\n##........##.......#.....###...\n.##....###........#..##...#...#\n......#..##....##.....#..#.#...\n.....#..##..#.......#.......#..\n......#....#.......##.#........\n.#.####.#..#......#..#.........\n.##..#....#...##.#....#....#...\n..#..#..#####.........#...#....\n....#.....#.#.#.#...#.#......#.\n....#...#.#..#.##...#...#......\n..#...#...#...#...#..#.#.##..#.\n..#......#.#.#.##.##.##..#.....\n#..###......#.##...#....#.##.#.\n.#.#.......##..##....##...##.#.\n.##......##....##.#.......#...#\n..#...#...................#....\n.#...#.......######.....#.#..##\n......#.##.....#.#.............\n...........##.#........#..#....\n#.............#.#.....#....##..\n#...........#...#..###.....#...\n....#.......#.#..#..#.#........\n......#...##.......#..##....#..\n......#.##.##..#........#.#...#\n.#..#...##...................#.\n.#.............#...#.#.#.#...#.\n.........#.....#........#.#....\n#..#...#.............##.#.....#\n...#.#....#...##............#..\n..#...#.##.###.#.....#......##.\n...#.#..###...#.#............#.\n...#....#........#.#...........\n.#......#.#.#.........#.#....#.\n....#..#......#.##.....#.#.....\n..#..###....#....#.........###.\n#..#.#....##.#....#.##..#......\n#..#.....#.#.....##..#.##......\n......#...#.#.............#..#.\n#.#....#.#..#...#......#.#.....\n..#.........#.#....#...#.......\n.#..#.#...#....#...#......#...#\n.......#........#.#..#..#...#..\n..##.#......#..##.##.#..#..#...\n.##...#....##.....#.....#...##.\n#.....##.#....#.#......##..#...\n.......#.#..#...#.......#.#...#\n..#...#.......#...#..##........\n#....##..#...#..#.#......#..#.#\n##.#....#....#....#...#..#.##..\n###........#.#..#..#......#....\n.#......#.....#....#.#..#...#..\n.#.....#.....#...##.......#..##\n#..##.#..#..........#..........\n...#.##.........#.#.##.#.......\n.#..#...............#...#.#.#..\n.....#.#.....#...####..#.....#.\n.#....#.##..##...#...##.#...#.#\n....#......##...#.#.#.....#.##.\n#...#..#.#...#.#.....##...#....\n..#..#....##..###......#..#....\n.........#......##.....##....#.\n.......#....#...#........###...\n.....#..#..#...#...#......#....\n..#..#...#.....#.....###..#.###\n............#.#..#..#....#.....\n...#..#...###.......#.......#..\n#.........#........#.....##....\n.#.#........#.....#........###.\n....#.##.#...#.#.#.....#....#..\n.##...#..#.......#.#...........\n##...#.##...#...........#.....#\n##....#.#.....##..#.......#....\n##....#...#....#..#.......####.\n......#...#..#.....#.#....#...#\n.......#.....#..###............\n#.#.#..#.....#.............#..#\n.#..#.....##.....#...#.......##\n..#.##........##...........#.#.\n....##.#..###.#.........#...##.")

    "numTreesHit" when {
      "given empty input" should {
        "return valid result" in {
          TobogganTrajectory.numTreesHit(
            InputParser.parse[String]("")
          ) should be(0)
        }
      }

      "given valid input" should {
        "return valid result" in {
          TobogganTrajectory.numTreesHit(exampleInput) should be(7)
        }

        "return valid result with larger input" in {
          TobogganTrajectory.numTreesHit(longInput) should be(289)
        }
      }

      "given invalid input" should {
        "throw an exception" in {
          the[UnsupportedObstacle] thrownBy {
            TobogganTrajectory.numTreesHit(
              InputParser.parse[String](
                "..##.......\n#...#...#..\n.#....#..#.\n..#.#...#.#\n.#.J.##..#.\n..#.##.....\n.#.#.#....#\n.#........#\n#.##...#...\n#...##....#\n.#..#...#.#"
              ))
          }
        }
      }
    }

    "productMultipleSlopes" when {
      "given valid input" should {
        "return valid result" in {
          TobogganTrajectory.productMultipleSlopes(exampleInput,
                                         List(1 -> 1,
                                              3 -> 1,
                                              5 -> 1,
                                              7 -> 1,
                                              1 -> 2)) should be(336)
        }

        "return valid result with larger input" in {
          TobogganTrajectory.productMultipleSlopes(longInput,
                                         List(1 -> 1,
                                              3 -> 1,
                                              5 -> 1,
                                              7 -> 1,
                                              1 -> 2)) should be(5522401584L)
        }
      }
    }

  }
}
